<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Regulation Comments Analysis - Comment Analysis Report</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            line-height: 1.5;
            background: #f8f9fa;
            color: #333;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h1 {
            font-size: 2em;
            color: #333;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1em;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .section {
            background: white;
            margin: 30px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        h2 {
            font-size: 1.5em;
            color: #333;
            margin-bottom: 20px;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
        }
        
        .filters-container {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #dee2e6;
        }
        
        .filters-header {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1.1em;
        }
        
        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .filter-label {
            font-weight: 500;
            color: #333;
            font-size: 0.9em;
        }
        
        .filterable {
            position: relative;
            cursor: pointer;
        }
        
        .filter-arrow {
            float: right;
            font-size: 12px;
            color: #666;
            margin-left: 8px;
            user-select: none;
        }
        
        .filter-arrow:hover {
            color: #007bff;
        }
        
        .filter-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            z-index: 1000;
            padding: 10px;
            min-width: 200px;
        }
        
        .filter-input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 12px;
            margin-bottom: 5px;
        }
        
        .filter-input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 1px rgba(0,123,255,0.25);
        }
        
        .filter-checkbox {
            display: block;
            margin: 5px 0;
            font-size: 13px;
            cursor: pointer;
        }
        
        .filter-checkbox input {
            margin-right: 6px;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }
        
        .checkbox-item input[type="checkbox"] {
            margin: 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        
        th {
            background: #e9ecef;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
            vertical-align: top;
        }
        
        tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        
        tr:hover {
            background-color: #e3f2fd;
        }
        
        .stance-for {
            background: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .stance-against {
            background: #dc3545;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .stance-neutral {
            background: #ffc107;
            color: #212529;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .stance-unknown {
            background: #6c757d;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .stances-container {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            max-width: 300px;
        }
        
        .stance-tag {
            background: #e3f2fd;
            color: #1976d2;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 10px;
            border: 1px solid #bbdefb;
        }
        
        .text-preview {
            max-width: 300px;
            max-height: 100px;
            overflow: hidden;
            font-size: 12px;
        }
        
        .comment-id {
            font-family: monospace;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 11px;
        }
        
        .comment-id a:hover {
            color: #0056b3 !important;
            background-color: #e3f2fd;
        }
        
        .date-cell {
            white-space: nowrap;
            font-size: 12px;
        }
        
        .attachment-indicator {
            font-size: 16px;
            color: #28a745;
        }
        
        .unique-indicator {
            background: #28a745;
            color: white;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .duplicate-indicator {
            background: #ffc107;
            color: #212529;
            padding: 2px 6px;
            border-radius: 8px;
            font-size: 11px;
            font-weight: 500;
        }
        
        .meta-info {
            background: #343a40;
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .meta-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }
        
        .meta-label {
            font-size: 0.8em;
            opacity: 0.8;
        }
        
        .meta-value {
            font-weight: 600;
        }
        
        
        .clear-filters {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .clear-filters:hover {
            background: #c82333;
        }
        
        .show-hide-columns {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        .show-hide-columns:hover {
            background: #0056b3;
        }
        
        .column-visibility-dropdown {
            position: relative;
            display: inline-block;
        }
        
        .column-visibility-content {
            display: none;
            position: absolute;
            background-color: white;
            min-width: 250px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
            z-index: 1000;
            border-radius: 4px;
            padding: 10px;
            border: 1px solid #ddd;
            top: 100%;
            left: 0;
        }
        
        .column-visibility-content.show {
            display: block;
        }
        
        .column-visibility-item {
            display: flex;
            align-items: center;
            padding: 5px 0;
            gap: 8px;
        }
        
        .column-visibility-item input[type="checkbox"] {
            margin: 0;
        }
        
        .column-visibility-item label {
            cursor: pointer;
            font-size: 14px;
            margin: 0;
        }
        
        .char-limited {
            cursor: help;
        }
        
        /* Custom tooltip styling for wider tooltips */
        .tooltip .tooltip-inner {
            max-width: 600px !important;
            width: auto !important;
            text-align: left !important;
            font-size: 13px !important;
            line-height: 1.4 !important;
            padding: 8px 12px !important;
        }
        
        /* Allow table to be wider and let columns size naturally */
        table {
            width: 100%;
            table-layout: auto;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        /* Only constrain the comment column to prevent it from being too wide */
        th[data-column="5"] {
            width: 25%;
            max-width: 400px;
        }
        
        .text-preview {
            max-width: 400px;
            word-wrap: break-word;
            overflow-wrap: break-word;
        }
        
        /* Co-occurrence table styles */
        .cooccurrence-table {
            border-collapse: collapse;
            font-size: 12px;
            margin: 0 auto;
        }
        
        .cooccurrence-table th,
        .cooccurrence-table td {
            border: 1px solid #dee2e6;
            text-align: center;
            padding: 8px;
            min-width: 40px;
        }
        
        .cooccurrence-table .stance-label {
            text-align: left;
            font-weight: 500;
            max-width: 200px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .rotate-header {
            height: 150px;
            white-space: nowrap;
            vertical-align: bottom;
        }
        
        .rotate-header > div {
            transform: translate(15px, 65px) rotate(-45deg);
            width: 30px;
            transform-origin: bottom left;
            font-size: 11px;
            font-weight: 500;
        }
        
        .diagonal-cell {
            background-color: #f8f9fa;
            font-weight: bold;
            color: #333;
        }
        
        .cooccurrence-cell {
            color: #333;
            font-weight: 500;
        }
        
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Regulation Comments Analysis</h1>
            <div class="subtitle">Analysis of public comments on federal regulation</div>
            
        </div>
        
        <!-- Summary Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number">2</div>
                <div class="stat-label">Total Comments</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">0</div>
                <div class="stat-label">With Attachments</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">875</div>
                <div class="stat-label">Avg. Characters</div>
            </div>
            <div class="stat-card">
                <div class="stat-number">2025-04-28</div>
                <div class="stat-label">Date Range</div>
            </div>
        </div>


        <!-- Analysis Field Distributions -->
        

        <!-- Comments Table -->
        <div class="section">
            <h2>Comments</h2>
            <div class="table-controls">
                <button class="clear-filters" onclick="clearAllFilters()">Clear All Filters</button>
                <div class="column-visibility-dropdown">
                    <button class="show-hide-columns" onclick="toggleColumnVisibility()">Show/Hide Columns</button>
                    <div class="column-visibility-content" id="columnVisibilityDropdown">
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-0" checked onchange="toggleColumn(0)">
                            <label for="col-0">Comment ID</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-1" checked onchange="toggleColumn(1)">
                            <label for="col-1">Date</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-2" checked onchange="toggleColumn(2)">
                            <label for="col-2">Submitter</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-3" checked onchange="toggleColumn(3)">
                            <label for="col-3">Organization</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-4" checked onchange="toggleColumn(4)">
                            <label for="col-4">Stances</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-5" checked onchange="toggleColumn(5)">
                            <label for="col-5">New Stances</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-6" checked onchange="toggleColumn(6)">
                            <label for="col-6">Comment</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-7" checked onchange="toggleColumn(7)">
                            <label for="col-7">Attachments</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-8" checked onchange="toggleColumn(8)">
                            <label for="col-8">Dup Count</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-9" checked onchange="toggleColumn(9)">
                            <label for="col-9">Dup Ratio</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-10" onchange="toggleColumn(10)">
                            <label for="col-10">Attachment</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-11" onchange="toggleColumn(11)">
                            <label for="col-11">Key Quote (LLM)</label>
                        </div>
                        <div class="column-visibility-item">
                            <input type="checkbox" id="col-12" onchange="toggleColumn(12)">
                            <label for="col-12">Rationale (LLM)</label>
                        </div>
                    </div>
                </div>
            </div>
                
            <div style="overflow-x: auto;">
                <table id="commentsTable" class="table table-striped">
                    <thead>
                        <tr>
                            <th class="filterable" data-column="0">
                                Comment ID <span class="filter-arrow" onclick="toggleFilter(0)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-0" style="display: none;">
                                    <input type="text" class="filter-input" data-column="0" placeholder="Filter ID..." onkeyup="filterTable()">
                                </div>
                            </th>
                            <th>Date</th>
                            <th class="filterable" data-column="2">
                                Submitter <span class="filter-arrow" onclick="toggleFilter(2)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-2" style="display: none;">
                                    <input type="text" class="filter-input" data-column="2" placeholder="Filter name..." onkeyup="filterTable()">
                                </div>
                            </th>
                            <th class="filterable" data-column="3">
                                Organization <span class="filter-arrow" onclick="toggleFilter(3)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-3" style="display: none;">
                                    <input type="text" class="filter-input" data-column="3" placeholder="Filter organization..." onkeyup="filterTable()">
                                </div>
                            </th>
                            <th class="filterable" data-column="4">
                                Stances <span class="filter-arrow" onclick="toggleFilter(4)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-4" style="display: none;">
                                    <hr style="margin: 5px 0;">
                                    <label class="filter-checkbox"><input type="checkbox" data-filter="unusual_combo" value="yes" onchange="filterTable()"> ‚ö†Ô∏è Unusual Combinations</label>
                                </div>
                            </th>
                            <th class="filterable" data-column="5">
                                New Stances <span class="filter-arrow" onclick="toggleFilter(5)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-5" style="display: none;">
                                </div>
                            </th>
                            <th class="filterable" data-column="6">
                                Comment <span class="filter-arrow" onclick="toggleFilter(6)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-6" style="display: none;">
                                    <input type="text" class="filter-input" data-column="6" placeholder="Search comment text..." onkeyup="filterTable()">
                                </div>
                            </th>
                            <th class="filterable" data-column="7">
                                üìé <span class="filter-arrow" onclick="toggleFilter(7)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-7" style="display: none;">
                                    <label class="filter-checkbox"><input type="checkbox" data-filter="attachments" value="yes" onchange="filterTable()"> With attachments</label>
                                    <label class="filter-checkbox"><input type="checkbox" data-filter="attachments" value="no" onchange="filterTable()"> No attachments</label>
                                </div>
                            </th>
                            <th class="filterable" data-column="8">
                                Dup Count <span class="filter-arrow" onclick="toggleFilter(8)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-8" style="display: none;"><label class="filter-checkbox"><input type="checkbox" data-filter="duplication_count" value="1" onchange="filterTable()"> 1</label>
                                </div>
                            </th>
                            <th class="filterable" data-column="9">
                                Dup Ratio <span class="filter-arrow" onclick="toggleFilter(9)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-9" style="display: none;"><label class="filter-checkbox"><input type="checkbox" data-filter="duplication_ratio" value="1" onchange="filterTable()"> 1:1</label>
                                </div>
                            </th>
                            <th class="filterable" data-column="10" style="display: none;">
                                Attachment <span class="filter-arrow" onclick="toggleFilter(10)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-10" style="display: none;">
                                    <input type="text" class="filter-input" data-column="10" placeholder="Search attachment text..." onkeyup="filterTable()">
                                </div>
                            </th>
                            <th class="filterable" data-column="11" style="display: none;">
                                Key Quote <span class="filter-arrow" onclick="toggleFilter(11)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-11" style="display: none;">
                                    <input type="text" class="filter-input" data-column="11" placeholder="Search quotes..." onkeyup="filterTable()">
                                </div>
                            </th>
                            <th class="filterable" data-column="12" style="display: none;">
                                Rationale <span class="filter-arrow" onclick="toggleFilter(12)">‚ñº</span>
                                <div class="filter-dropdown" id="filter-12" style="display: none;">
                                    <input type="text" class="filter-input" data-column="12" placeholder="Search rationale..." onkeyup="filterTable()">
                                </div>
                            </th>
                        </tr>
                    </thead>
                        <tbody>

                            <tr>
                                <td><span class="comment-id"><a href="https://www.regulations.gov/comment/OPM-2025-0004-0002" target="_blank" style="color: #007bff; text-decoration: underline;">OPM-2025-0004-0002</a></span></td>
                                <td class="date-cell">2025-04-28</td>
                                <td>Comment from Elsa Lankford</td>
                                <td></td>
                                <td><span style="color: #999;">None</span></td>
                                <td><span style="color: #999;">None</span></td>
                                <td class="text-preview"></td>
                                <td></td>
                                <td><span class="unique-indicator">1</span></td>
                                <td><span class="unique-indicator">1:1</span></td>
                                <td style="display: none;"></td>
                                <td style="display: none;"></td>
                                <td style="display: none;"></td>
                            </tr>

                            <tr>
                                <td><span class="comment-id"><a href="https://www.regulations.gov/comment/OPM-2025-0004-0003" target="_blank" style="color: #007bff; text-decoration: underline;">OPM-2025-0004-0003</a></span></td>
                                <td class="date-cell">2025-04-28</td>
                                <td>Comment from Anonymous</td>
                                <td></td>
                                <td><span style="color: #999;">None</span></td>
                                <td><span style="color: #999;">None</span></td>
                                <td class="text-preview"></td>
                                <td></td>
                                <td><span class="unique-indicator">1</span></td>
                                <td><span class="unique-indicator">1:1</span></td>
                                <td style="display: none;"></td>
                                <td style="display: none;"></td>
                                <td style="display: none;"></td>
                            </tr>

                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Meta Information -->
        <div class="meta-info">
            <h3 style="color: white; margin-bottom: 20px;">üìã Report Details</h3>
            <div class="meta-grid">
                <div class="meta-item">
                    <div class="meta-label">Generated</div>
                    <div class="meta-value">2025-06-28 20:30:24</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Model Used</div>
                    <div class="meta-value">gpt-4o-mini</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Total Comments</div>
                    <div class="meta-value">2</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">With Attachments</div>
                    <div class="meta-value">0</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Average Length</div>
                    <div class="meta-value">875 chars</div>
                </div>
                <div class="meta-item">
                    <div class="meta-label">Date Range</div>
                    <div class="meta-value">2025-04-28</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Column visibility state (13 columns with new_stances)
        const columnVisibility = {
            0: true, 1: true, 2: true, 3: true, 4: true, 5: true, 6: true, 7: true, 8: true, 9: true, 10: false, 11: false, 12: false
        };

        // Initialize column visibility on page load
        document.addEventListener('DOMContentLoaded', function() {
            for (const [col, visible] of Object.entries(columnVisibility)) {
                updateColumnVisibility(parseInt(col), visible);
                // Also update the checkbox state
                const checkbox = document.getElementById('col-' + col);
                if (checkbox) {
                    checkbox.checked = visible;
                }
            }
        });

        function toggleColumnVisibility() {
            const dropdown = document.getElementById('columnVisibilityDropdown');
            dropdown.classList.toggle('show');
        }

        function toggleColumn(columnIndex) {
            const checkbox = document.getElementById('col-' + columnIndex);
            const visible = checkbox.checked;
            columnVisibility[columnIndex] = visible;
            updateColumnVisibility(columnIndex, visible);
        }

        function updateColumnVisibility(columnIndex, visible) {
            const table = document.getElementById('commentsTable');
            const rows = table.getElementsByTagName('tr');
            
            // Update header
            const headers = rows[0].getElementsByTagName('th');
            if (headers[columnIndex]) {
                headers[columnIndex].style.display = visible ? '' : 'none';
            }
            
            // Update all data rows
            for (let i = 1; i < rows.length; i++) {
                const cells = rows[i].getElementsByTagName('td');
                if (cells[columnIndex]) {
                    cells[columnIndex].style.display = visible ? '' : 'none';
                }
            }
        }

        function filterTable() {
            const table = document.getElementById('commentsTable');
            const rows = table.getElementsByTagName('tr');
            
            // Get text input filters
            const textFilters = document.querySelectorAll('.filter-input');
            const textFilterValues = Array.from(textFilters).map(filter => {
                return {
                    column: parseInt(filter.getAttribute('data-column')),
                    value: filter.value.toLowerCase()
                };
            });
            
            // Get checkbox filters
            const stanceCheckboxes = document.querySelectorAll('input[data-filter="stances"]:checked');
            const newStanceCheckboxes = document.querySelectorAll('input[data-filter="new_stances"]:checked');
            const unusualComboCheckboxes = document.querySelectorAll('input[data-filter="unusual_combo"]:checked');
            const attachmentCheckboxes = document.querySelectorAll('input[data-filter="attachments"]:checked');
            const duplicationCountCheckboxes = document.querySelectorAll('input[data-filter="duplication_count"]:checked');
            const duplicationRatioCheckboxes = document.querySelectorAll('input[data-filter="duplication_ratio"]:checked');
            
            const selectedStances = Array.from(stanceCheckboxes).map(cb => cb.value.toLowerCase());
            const selectedNewStances = Array.from(newStanceCheckboxes).map(cb => cb.value.toLowerCase());
            const filterUnusualCombos = unusualComboCheckboxes.length > 0;
            const selectedAttachments = Array.from(attachmentCheckboxes).map(cb => cb.value);
            const selectedDuplicationCounts = Array.from(duplicationCountCheckboxes).map(cb => parseInt(cb.value));
            const selectedDuplicationRatios = Array.from(duplicationRatioCheckboxes).map(cb => parseInt(cb.value));

            // Always assume new_stances column exists (column 5)
            const hasNewStances = true;
            
            // Filter each row
            for (let i = 1; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');
                let showRow = true;

                // Check text filters
                for (const filter of textFilterValues) {
                    if (filter.value && filter.column < cells.length) {
                        const cellText = cells[filter.column].textContent.toLowerCase();
                        if (!cellText.includes(filter.value)) {
                            showRow = false;
                            break;
                        }
                    }
                }
                
                // Check stance filter (column 4)
                if (showRow && selectedStances.length > 0) {
                    const stanceText = cells[4].textContent.toLowerCase();
                    if (!selectedStances.some(stance => stanceText.includes(stance))) {
                        showRow = false;
                    }
                }
                
                // Check unusual combination filter
                if (showRow && filterUnusualCombos) {
                    const stanceCell = cells[4].innerHTML;
                    if (!stanceCell.includes('‚ö†Ô∏è')) {
                        showRow = false;
                    }
                }
                
                // Check new stance filter (column 5 if exists)
                if (showRow && hasNewStances && selectedNewStances.length > 0) {
                    const newStanceText = cells[5].textContent.toLowerCase();
                    if (!selectedNewStances.some(stance => newStanceText.includes(stance))) {
                        showRow = false;
                    }
                }
                
                // Column positions shift by 1 when new_stances exists
                const attachmentCol = hasNewStances ? 7 : 6;
                const dupCountCol = hasNewStances ? 8 : 7;
                const dupRatioCol = hasNewStances ? 9 : 8;
                
                // Check attachments filter
                if (showRow && selectedAttachments.length > 0) {
                    const attachmentCell = cells[attachmentCol];
                    const hasAttachment = attachmentCell.textContent.trim() !== '';
                    
                    let attachmentMatch = false;
                    for (const filter of selectedAttachments) {
                        if (filter === 'yes' && hasAttachment) {
                            attachmentMatch = true;
                            break;
                        }
                        if (filter === 'no' && !hasAttachment) {
                            attachmentMatch = true;
                            break;
                        }
                    }
                    
                    if (!attachmentMatch) {
                        showRow = false;
                    }
                }
                
                // Check duplication count filter
                if (showRow && selectedDuplicationCounts.length > 0) {
                    const duplicationCell = cells[dupCountCol];
                    const duplicationText = duplicationCell.textContent.trim();
                    const duplicationCount = parseInt(duplicationText);
                    
                    if (!selectedDuplicationCounts.includes(duplicationCount)) {
                        showRow = false;
                    }
                }
                
                // Check duplication ratio filter
                if (showRow && selectedDuplicationRatios.length > 0) {
                    const ratioCell = cells[dupRatioCol];
                    const ratioText = ratioCell.textContent.trim();
                    // Extract number after "1:" (e.g., "1:10" -> 10)
                    const ratioMatch = ratioText.match(/1:(\d+)/);
                    const ratioValue = ratioMatch ? parseInt(ratioMatch[1]) : 1;
                    
                    if (!selectedDuplicationRatios.includes(ratioValue)) {
                        showRow = false;
                    }
                }

                row.style.display = showRow ? '' : 'none';
            }
        }
        
        function toggleFilter(columnIndex) {
            const dropdown = document.getElementById('filter-' + columnIndex);
            const allDropdowns = document.querySelectorAll('.filter-dropdown');
            
            // Close all other dropdowns
            allDropdowns.forEach(dd => {
                if (dd !== dropdown) {
                    dd.style.display = 'none';
                }});
            
            // Toggle current dropdown
            dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
        }
        
        function clearAllFilters() {
            const textFilters = document.querySelectorAll('.filter-input');
            const checkboxes = document.querySelectorAll('input[type="checkbox"]');
            
            textFilters.forEach(filter => filter.value = '');
            checkboxes.forEach(checkbox => checkbox.checked = false);
            
            filterTable();
        }
        
        // Close dropdowns when clicking outside
        document.addEventListener('click', function(event) {
            const isFilterClick = event.target.closest('.filterable') || event.target.closest('.filter-dropdown');
            const isColumnVisClick = event.target.closest('.column-visibility-dropdown');
            
            if (!isFilterClick) {
                document.querySelectorAll('.filter-dropdown').forEach(dd => {
                    dd.style.display = 'none';
                });
            }
            
            if (!isColumnVisClick) {
                document.getElementById('columnVisibilityDropdown').classList.remove('show');
            }
        });
        
        // Initialize Bootstrap tooltips
        function initializeTooltips() {
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]');
            [...tooltipTriggerList].forEach(tooltipTriggerEl => {
                try {
                    // Dispose existing tooltip if any
                    const existingTooltip = bootstrap.Tooltip.getInstance(tooltipTriggerEl);
                    if (existingTooltip) {
                        existingTooltip.dispose();
                    }
                    
                    // Create new tooltip
                    new bootstrap.Tooltip(tooltipTriggerEl, {
                        boundary: document.body,
                        trigger: 'hover focus',
                        container: 'body'
                    });
                } catch (err) {
                    console.error('Error initializing tooltip:', err);
                }
            });
        }
        
        // Initialize tooltips when page loads
        document.addEventListener('DOMContentLoaded', function() {
            initializeTooltips();
        });
    </script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
